<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        .preview{
            background-color:#D1a543;
        }
        .panel{
            background-color: gold;
        }
        .emoji_btn{
            width: 60px;
        }
        .accordion-collapse .btn.active{
            border:1px solid orange;
        }
    </style>
</head>
<body>
    <div >
        <div class="row">
            <div class="preview col-xl-8 col-lg-8 col-12">
                <img src="./assets/ALKE_Jaffa-20_White_Calf_Birdseye_Personalisation_Empty_thumbnail_Web.png" alt="">
            </div>
            <div class="panel col-xl-4 col-lg-4 col-12 ">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Left</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Right</button>
                    </li>
                   
                  </ul>
                  <div class="tab-content" id="myTabContent">

                    <!-- left Tab -->
                    <div class="tab-pane fade show active Left" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                        <div class="accordion accordion-flush leftAccordion" id="accordionFlushExample">
                            <!-- Initial Tab -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                                    INITIALS
                                  </button>
                                </h2>
                                <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                  <div class="accordion-body">
                                      <div class="input-group mb-3">
                                          <input type="text" class="form-control" placeholder="Left Initial,Letters Only" aria-label="Recipient's username" aria-describedby="basic-addon2"
                                          maxlength="1"
                                          pattern="[A-Za-z]">
                                        </div>
                                  </div>
                                </div>
                              </div>
                              <!-- Emoji Tab -->
                              <div class="accordion-item">
                                <h2 class="accordion-header">
                                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                                    EMOJIS
                                  </button>
                                </h2>
                                <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                  <div class="accordion-body ">
                                        <button type="button" class="btn " value="emoji-01">
                                            <img src="https://www.sauvereign.com/wp-content/uploads/2024/01/emoji-01.png" class="emoji_btn">
                                        </button>
                                        <button type="button" class="btn " value="emoji-02">
                                            <img src="https://www.sauvereign.com/wp-content/uploads/2024/01/emoji-02.png" class="emoji_btn">
                                        </button>
                                        <button type="button" class="btn" value="emoji-03">
                                            <img src="https://www.sauvereign.com/wp-content/uploads/2024/01/emoji-03.png" class="emoji_btn">
                                        </button>
                                        <button type="button" class="btn" value="emoji-04">
                                            <img src="https://www.sauvereign.com/wp-content/uploads/2024/01/emoji-04.png" class="emoji_btn">
                                        </button>
                                  </div>
                                </div>
                              </div>
                              <!-- Special Order Tab -->
                              <div class="accordion-item">
                                <h2 class="accordion-header">
                                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
                                    SPECIAL ORDERS
                                  </button>
                                </h2>
                                <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                  <div class="accordion-body ">
                                    <button type="button" class="btn " value="spe-01">
                                        <img src="https://www.sauvereign.com/wp-content/uploads/2024/01/spe-01.png" class="emoji_btn">
                                    </button>
                                    <button type="button" class="btn " value="spe-02">
                                        <img src="https://www.sauvereign.com/wp-content/uploads/2024/01/spe-02.png" class="emoji_btn">
                                    </button>
                                  </div>
                                </div>
                              </div>
                          </div>
                    </div>

                    <!-- Right Tab -->
                    <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
                        <div class="accordion accordion-flush rightAccordion" id="accordionFlushExample">
                            <!-- Initial Tab -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                                    INITIALS
                                  </button>
                                </h2>
                                <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                  <div class="accordion-body">
                                      <div class="input-group mb-3">
                                          <input type="text" class="form-control" placeholder="Left Initial" aria-label="Recipient's username" aria-describedby="basic-addon2">
                                        </div>
                                  </div>
                                </div>
                              </div>
                              <!-- Emoji Tab -->
                              <div class="accordion-item">
                                <h2 class="accordion-header">
                                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                                    EMOJIS
                                  </button>
                                </h2>
                                <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                  <div class="accordion-body ">
                                        <button type="button" class="btn ">
                                            <img src="https://sauvereign.com/wp-content/uploads/2022/11/pic-01-red.png" class="emoji_btn">
                                        </button>
                                        <button type="button" class="btn ">
                                            <img src="https://sauvereign.com/wp-content/uploads/2022/11/pic-02-red.png" class="emoji_btn">
                                        </button>
                                        <button type="button" class="btn">
                                            <img src="https://sauvereign.com/wp-content/uploads/2022/11/pic-03-red.png" class="emoji_btn">
                                        </button>
                                  </div>
                                </div>
                              </div>
                              <!-- Special Order Tab -->
                              <div class="accordion-item">
                                <h2 class="accordion-header">
                                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                                    SPECIAL ORDERS
                                  </button>
                                </h2>
                                <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                  <div class="accordion-body ">
                                        <button type="button" class="btn ">
                                            <img src="https://sauvereign.com/wp-content/uploads/2022/11/pic-01-red.png" class="emoji_btn">
                                        </button>
                                        <button type="button" class="btn ">
                                            <img src="https://sauvereign.com/wp-content/uploads/2022/11/pic-02-red.png" class="emoji_btn">
                                        </button>
                                        <button type="button" class="btn active">
                                            <img src="https://sauvereign.com/wp-content/uploads/2022/11/pic-03-red.png" class="emoji_btn">
                                        </button>
                                  </div>
                                </div>
                              </div>
                          </div>
                    </div>
                    
                  </div>
            </div>
        </div>
    </div>
    

    <!-- 引入 boostrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<!-- 引入html2canvas -->
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<!-- 引入merge-images -->
<script src="https://unpkg.com/merge-images"></script>

<script>
          let shoePersonalization = {
           left:'',
           right:''
          }

            //  合成圖像的函數
     function mergeImage(obj){
        
        console.log(obj,'obj');

        let leftUrl =`https://www.sauvereign.com/wp-content/uploads/2024/01/${obj.left}.png`
        let rightUrl =`https://www.sauvereign.com/wp-content/uploads/2024/01/${obj.right}.png`
        console.log(obj.left.length,'obj.left.length');

        if(obj.left===''||obj.right===''){
                    console.log('只選了一遍');
                    // 是但一邊沒有定制的時候，只需要合成三幅圖像（鞋圖，帶圖，圖案或字圖）
                    if(obj.left){
                                        mergeImages([
                        {src:'https://www.sauvereign.com/wp-content/uploads/2023/11/ALKE_Jaffa-20_White_Calf_Birdseye_Personalisation_Empty_thumbnail_Web.png',x:0,y:0},
                        {src:leftUrl,x:250,y:300},
                        ],{crossOrigin:"anonymous"}).then(b64=>{
                    document.querySelector('.preview img').src=b64
                })
                    }else{
                        mergeImages([
                        {src:'https://www.sauvereign.com/wp-content/uploads/2023/11/ALKE_Jaffa-20_White_Calf_Birdseye_Personalisation_Empty_thumbnail_Web.png',x:0,y:0},
                        {src:rightUrl,x:350,y:300},
                        ],{crossOrigin:"anonymous"}).then(b64=>{
                    document.querySelector('.preview img').src=b64
                })
                    }
                    

        }else{
                   // 兩邊都有定制的時候，需要合成4幅圖像（鞋圖，帶圖，圖案或字圖x2）
                   console.log('two sides');
        }


        // for(let k in obj){
        //     // console.log(obj[k],'objk');
        //     if(obj[k]){
                
        //         if(k==='leftEmoji'&&obj[k]==='emoji01'){
        //             mergeImages([
        //                 {src:'https://www.sauvereign.com/wp-content/uploads/2023/11/ALKE_Jaffa-20_White_Calf_Birdseye_Personalisation_Empty_thumbnail_Web.png',x:0,y:0},
        //                 {src:'https://sauvereign.com/wp-content/uploads/2022/11/pic-01-red.png',x:250,y:300},
        //                 ],{crossOrigin:"anonymous"}).then(b64=>{
        //             document.querySelector('.preview img').src=b64
        //         })
        //         }else if(k==='leftEmoji'&&obj[k]==='emoji02'){
        //             mergeImages([
        //                 {src:'https://www.sauvereign.com/wp-content/uploads/2023/11/ALKE_Jaffa-20_White_Calf_Birdseye_Personalisation_Empty_thumbnail_Web.png',x:0,y:0},
        //                 {src:'https://sauvereign.com/wp-content/uploads/2022/11/pic-02-red.png',x:250,y:300},
        //                 ],{crossOrigin:"anonymous"}).then(b64=>{
        //             document.querySelector('.preview img').src=b64
        //         })
        //         }else if(k==='leftInitial'){
        //             console.log(k,obj[k],'k');
        //             mergeImages([
        //                 {src:'https://www.sauvereign.com/wp-content/uploads/2023/11/ALKE_Jaffa-20_White_Calf_Birdseye_Personalisation_Empty_thumbnail_Web.png',x:0,y:0},
        //                 {src:`https://www.sauvereign.com/wp-content/uploads/2022/10/letter_${obj[k]}_red.png`,x:250,y:300},
        //                 ],{crossOrigin:"anonymous"}).then(b64=>{
        //             document.querySelector('.preview img').src=b64
        //         })
        //         }
                
        //     }
        // }

                 
     }


    //  獲取左鞋的所有按鈕
          const leftBtns=document.querySelectorAll('.Left .accordion-collapse .btn')
          console.log(leftBtns,'btns');
        //   為左鞋的所有按鈕綁定點擊事件
          for(let i=0;i<leftBtns.length;i++){
                   leftBtns[i].addEventListener('click',function(){
                    console.log(this.value,'this.value');
                    // 清除現有邊框
                    if(document.querySelector('.Left .accordion-collapse .btn.active')){

                        document.querySelector('.Left .accordion-collapse .btn.active').classList.remove('active')
                    }
                    
                    
                    // 自己添加邊框
                    this.classList.add('active')

                    // 不管文本框有沒有輸入，都清空輸入
                    document.querySelector('input[placeholder="Left Initial"]').value=''

                    
                    shoePersonalization.left=this.value
                    console.log(shoePersonalization,'shoePersonalization');

                    // 合成圖像
                    mergeImage(shoePersonalization)


                   })

          }

    // 獲取左鞋的文本框
          const leftTxt=document.querySelector('.Left input')

        //   為左鞋的文本框綁定變化事件
        leftTxt.addEventListener('input',function(e){
                  console.log(e.target.value,'e.target.value');
                //   正則表達式
                const regex = /^[A-Za-z]+$/

                  if(regex.test(e.target.value)){
                    // 如果輸入了字母
                    let letter = e.target.value.toLowerCase()
                    shoePersonalization.left=`letter_${letter}_red`
                    console.log(shoePersonalization,'shoePersonalization');
                  }else{
                    // 如果輸入其他字符，清空文本框
                    leftTxt.value=''
                  }
        })

     
    //  document.querySelector('label[for="left_emoji02"]').addEventListener('click',function(){
    //     // 清除別人的邊框
    //     document.querySelector('label[for="left_emoji01"]').style.border='none'
    //     // 顯示邊框
    //     this.style.border = '1px solid #d1a543'

    //     // 清空其他所有已選的值
    //     document.querySelector('input[placeholder="Left Initial"]').value=''

    //     // 之前的定制選項清空
    //     shoePersonalization.leftInitial=''
    //     //   更改鞋的定制選項
    //       shoePersonalization.leftEmoji='emoji02'

    //     console.log(shoePersonalization,'sp');

    //     //   合成圖像
    //         mergeImage(shoePersonalization)


    //  })



  
</script>
</body>
</html>